\documentclass[11pt,a4]{article}

\usepackage[margin=2cm]{geometry}

\usepackage{amsmath}
\usepackage{url}

\usepackage{amsmath}
\usepackage{url}

\usepackage[utf8]{inputenc}

% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{10} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{10}  % for normal

% Custom colors
\usepackage{color}
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

\usepackage{listings}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
language=Python,
basicstyle=\ttm,
otherkeywords={self},             % Add keywords here
keywordstyle=\ttb\color{deepblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\ttb\color{deepred},    % Custom highlighting style
stringstyle=\color{deepgreen},
frame=tb,                         % Any extra options here
showstringspaces=false            % 
}}


% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
\pythonstyle
\lstinputlisting[#1]{#2}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}


\usepackage{collectbox}

\newcommand{\mybox}[2]{$\quad$\fbox{
\begin{minipage}{#1cm}
\hfill\vspace{#2cm}
\end{minipage}
}}


\usepackage{fancyhdr}
\pagestyle{fancy}
\rhead{Programmazione 1 - Esercitazione 8}

\include{book_header}

\begin{document}
\thispagestyle{empty}
\hrule
\begin{center}
   {\Large {\bf Programmazione 1 \hspace{3cm} $\quad \quad \quad$ Esercitazione 8}}
\end{center}
{\bf Cognome: }\hspace{2.5cm} {\bf Nome: } \hspace{2.5cm} {\bf Matricola: } \\\
\hrule

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{}
Questa è la seconda esercitazione per arrivare all'implementazione di un programma che possa fare delle semplici previsioni
sui voti che un utente potrebbe dare a dei film che non ha ancora valutato.

Rispetto alla prima esercitazione si deve usare anche file di testo:
\begin{enumerate}
\item {\tt u1.test}: contiene le valutazioni degli utenti ai film, su una scala da 1 a 5. 
\end{enumerate}

L'esercitazione va svolta in parte riprendendo le soluzione dell'esercitazione 7, ma scrivendo un nuovo file python.
Scrivere in coda al file all'interno del blocco {\tt if \_\_name\_\_ == "\_\_main\_\_":} l'insieme di chiamate alle vostre funzioni
che permettano di controllarne il corretto funzionamento.

\begin{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere la funzione {\tt ParseRating(filename)} che legge il file {\tt filename}
e restituisce un dizionario con una chiave per ogni coppia (user id, item id), e come valore il rispettivo rating. 
Il rating deve essere memorizzato come un numero intero.
Il file di input contiene le informazioni seguenti:
\begin{center}
{\tt user id | item id | rating | timestamp}
\end{center}

\mybox{15}{2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere una funzione {\tt ComputeAverage(Ls)} che prende in input un dizionario di valutazioni (come letto all'esercizio 1) e calcola
la media aritmetica di tutte le valutazioni. La funzione deve restituire la media.

\mybox{15}{2}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere una funzione {\tt ComputeItemAverage(Ls)} che prende in input un dizionario di valutazioni e calcola
per ciascun film (in genere si parla di {\it item}) la media aritmetica di tutte le valutazioni. La funzione deve restituire un dizionario con una chiave
per ogni film id e come valore la media di voti ricevuti da quel film. Se un film non ha ricevuto nessun voto,
il suo valore potrebbe essere la media globale.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere una funzione {\tt ComputeUserAverage(Ls)} che prende in input un dizionario di valutazioni e calcola
per ciascun utente la media aritmetica di tutte le valutazioni. La funzione deve restituire un dizionario con una chiave
per ogni user id e come valore la media di voti dati da quell'utente. Se un utente non ha dato nessun voto,
il suo valore potrebbe essere la media globale.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere una funzione {\tt ComputeUserTypeAverage(Ls)} che prende in input un dizionario di valutazioni e calcola
per ciascuna categoria di utente la media aritmetica di tutte le valutazioni. La funzione deve restituire un dizionario con una chiave
per ciascuna categoria di utente e come valore la media dei voti dati da quella categoria. Se una categoria non ha dato nessun voto,
il suo valore potrebbe essere la media globale.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere una funzione {\tt PredictAvg(Ls)} che prende in input il dizionario di valutazioni da predire
e per ogni coppia (utente, film) per cui si deve fare una previsione, restituisce la media globale.
Usare la funzione passandogli in input la lista di valutazioni contenuta nel file {\tt u1.test}.
In questo caso, la funzione deve restituire un dizionario, in cui la chiave è la coppia (id utente, id item), e il
valore è il rating predetto, ovvero la media globale, opportunamente arrotondata (non si possono predire frazioni di voto).

\mybox{15}{3}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere una funzione {\tt RMSE(Ls)} che calcola il {\bf {\it Root Mean Square Error (RMSE)}} delle vostre predizioni.
Ovvero, date $n$ predizioni $\hat{y}_i$ e dati i valori reali delle rispettive osservazioni $y_i$, si calcola l'errore complessivo con la formula:
$$
	\mbox{RMSE}(\hat{y}, y) = \sqrt{\frac{\sum_{i=1}^n (\hat{y}_i - y_i)^2}{n}}
$$

\mybox{15}{3}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Valutare il RMSE per le predizioni ottenute con la funzione {\tt PredictAverage} usando le valutazioni contenute nel file di test.

\mybox{15}{3}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item Scrivere le funzioni {\tt PredictAvgItem(Ls)}, {\tt PredictAvgUser(Ls)} e {\tt PredictAvgCategory(Ls)}, che effettuano
le predizioni di voto in base alle rispettive medie calcolate con le soluzioni degli esercizi precedenti.
Usando come funzione di valutazione la RMSE, confrontare le prestazioni dei 4 semplici approcci proposti.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item {\bf CHALLENGE 5:} Elaborare un metodo per ottenere il valore di RMSE il più piccolo possibile. Il metodo proposto
dovrebbe ottenere dei risultati migliori di quelli ottenuti con i 4 metodi precedenti, chiamati {\it baselines}.
Testare il vostro metodo usando i seguenti dati: elaborare il modello di predizione con il file {\tt uX.base}, con $X \in \{1,..,5\}$,
e testare il modello con i rispettivi {\tt uX.test} file, con $X \in \{1,..,5\}$. 

{\bf NOTA:} non è possibile incrociare i file di base con quelli di test.

{\bf Facoltativo:} Mandare la vostra soluzione per email al docente. Riportare nell'email il valore di RMSE ottenuto per i cinque diversi data set.


\end{enumerate}

\end{document}
